!function(a,b){"object"==typeof exports?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.promizr=a.pzr={})}(this,function(a){"use strict";function b(a,b){var c=a.map(b);return Promise.all(c).then(function(){})}function c(a,b){return new Promise(function(c,d){function e(c,d){return function(){return b(c,d,a)}}for(var f=Promise.resolve(),g=0,h=a.length;h>g;g++)f=f.then(e(a[g],g));return f.then(function(){return c()},d)})}function d(a,b){var c=a.map(b);return Promise.all(c)}function e(a,b){function d(c,d){return b(c,d,a).then(function(a){e[d]=a})}var e=[];return c(a,d).then(function(){return e})}function f(a,b){var c=[],d=a.map(function(a,d,e){return b(a,d,e).then(function(b){b&&c.push(a)})});return Promise.all(d).then(function(){return c})}function g(a,b){function d(c,d){return b(c,d,a).then(function(a){a&&e.push(c)})}var e=[];return c(a,d).then(function(){return e})}function h(a,b){var c=[],d=a.map(function(a,d,e){return b(a,d,e).then(function(b){b||c.push(a)})});return Promise.all(d).then(function(){return c})}function i(a,b){function d(c,d){return b(c,d,a).then(function(a){a||e.push(c)})}var e=[];return c(a,d).then(function(){return e})}function j(a,b,d){function e(a,c){return d(b,a).then(function(a){b=a})}return c(a,e).then(function(){return b})}function k(a,b,c){var d=[].concat(a).reverse();return j(d,b,c)}function l(a,b){var c=a.length,d=0;return new Promise(function(e,f){a.forEach(function(a,g,h){return b(a,g,h).then(function(b){b?e(a):++d===c&&e()},f)})})}function m(a,b){var d=a.length-1;return new Promise(function(e,f){c(a,function(a,c,g){return b(a,c,g).then(function(b){b?e(a):c===d&&e()},f)})})}function n(a,b){function c(c,d){return b(c,d,a).then(function(a){return{source:c,result:a}})}function e(a,b){var c=a.result,d=b.result;return d>c?-1:c>d?1:0}return d(a,c).then(function(a){return a.sort(e).map(function(a){return a.source})})}function o(a,b){return l(a,b).then(function(a){return!!a})}function p(a,b){var c=a.map(function(a,c,d){return b(a,c,d).then(function(a){if(!a)throw new Error("PROMIZR_NOTOK")})});return Promise.all(c).then(function(){return!0})["catch"](function(a){if("PROMIZR_NOTOK"!==a.message)throw a;return!1})}function q(a,b){return d(a,b).then(function(a){return Array.prototype.concat.apply([],a.filter(function(a){return!!a}))})}function r(a,b){return e(a,b).then(function(a){return Array.prototype.concat.apply([],a.filter(function(a){return!!a}))})}function s(a){function b(b){return a[b]().then(function(a){f.push(a)})}for(var c=Promise.resolve(),d=0,e=a.length,f=[];e>d;d++)c=c.then(b.bind(null,d));return c.then(function(){return f})}function t(a){function b(b){return a[b]().then(function(a){e[b]=a})}var c,d=Promise.resolve(),e={};for(c in a)na.call(a,c)&&(d=d.then(b.bind(null,c)));return d.then(function(){return e})}function u(a){return Array.isArray(a)?s(a):t(a)}function v(a){var b=a.map(function(a){return a()});return Promise.all(b)}function w(a){function b(b){return a[b]().then(function(a){e[b]=a})}var c,d=[],e={};for(c in a)na.call(a,c)&&d.push(b(c));return Promise.all(d).then(function(){return e})}function x(a){return Array.isArray(a)?v(a):w(a)}function y(a,b){function c(){return a()?b().then(c):void 0}return Promise.resolve().then(c)}function z(a,b){function c(){return a().then(function(a){return b(a)?c():void 0})}return Promise.resolve().then(c)}function A(a,b){function c(){return a()?void 0:b().then(c)}return Promise.resolve().then(c)}function B(a,b){function c(){return a().then(function(a){return b(a)?void 0:c()})}return Promise.resolve().then(c)}function C(a){function b(){return a().then(b)}return Promise.resolve().then(b)}function D(a){for(var b=Promise.resolve(),c=0,d=a.length;d>c;c++)b=b.then(a[c]);return b}function E(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return function(){var b=Promise.resolve(),c=a.pop(),d=this,e=arguments,f=a.length-1;for(b=b.then(function(){return c.apply(d,e)});f>=0;f--)b=b.then(a[f]);return b}}function F(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return function(){var b=Promise.resolve(),c=a.shift(),d=this,e=arguments,f=0,g=a.length;for(b=b.then(function(){return c.apply(d,e)});g>f;f++)b=b.then(a[f]);return b}}function G(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return b.length>0?(a=a.map(function(a){return function(){return a.apply(null,b)}}),x(a)):function(){var b=this,c=arguments;return a=a.map(function(a){return function(){return a.apply(b,c)}}),x(a)}}function H(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return b.length>0?(a=a.map(function(a){return function(){return a.apply(null,b)}}),u(a)):function(){var b=this,c=arguments;return a=a.map(function(a){return function(){return a.apply(b,c)}}),u(a)}}function I(a,b){var c;try{c=Promise.resolve(b())}catch(d){c=Promise.reject(d)}return c["catch"](function(c){if(a>1)return I(a-1,b);throw c})}function J(a,b){for(var c=[],d=a;d>0;d--)try{c.push(b())}catch(e){c.push(Promise.reject(e))}return Promise.all(c)}function K(a,b){function c(){return Promise.resolve(b()).then(function(a){e.push(a)})}for(var d=Promise.resolve(),e=[],f=a;f>0;f--)d=d.then(c);return d.then(function(){return e})}function L(a){return"progress"in a}function M(a){return function(b){for(var c=a._progressesCallbacks,d=c.length,e=0;d>e;e++)c[e].call(void 0,b);a._progress=b}}function N(a,b){for(var c,d=a.length,e=new Array(d),f=0;d>f;f++)c=a[f],e[f]=void 0,L(c)&&c.progress(O.bind(void 0,b,e,f))}function O(a,b,c,d){b[c]=d,a(b)}function P(){this._progressesCallbacks=void 0}function Q(a,b,c){return new ra(a,b,c)}function R(a,b,c){return new sa(a,b,c)}function S(a,b){return new ta(a,b)}function T(a,b){return new ua(a,b)}function U(a,b,c){var d=a.map(function(a,b,d){return function(){return c(a,b,d)}});return S(b).push(d).then(function(){})}function V(a,b,c){var d=a.map(function(a,b,d){return function(){return c(a,b,d)}});return S(b).push(d)}function W(a,b){function c(a){return d[a]().then(function(b){f[a]=b})}if(Array.isArray(a))return S(b).push(a);var d=a,e=Object.keys(d),f={};return Q(c,b).push(e).then(function(){return f})}function X(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return function(){return a.apply(null,b)}}function Y(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];return function(){return"string"==typeof b?a[b].apply(a,c):b.apply(a,c)}}function Z(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return function(){return a.apply(null,b.concat(arguments))}}function $(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];return function(){return"string"==typeof b?a[b].apply(a,c.concat(arguments)):b.apply(a,c.concat(arguments))}}function _(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return function(c){return Promise.resolve(a.apply(null,b)).then(function(){return c})}}function aa(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];return function(d){return"string"==typeof b?a[b].apply(a,c):b.apply(a,c),d}}function ba(a,b){function c(a,b){g?e[a]=b:e=b}function d(){var b,d,h=va.apply(arguments);return g?(b=f(h),d=e[b]):d=e,d?Promise.resolve(d):(d=a.apply(null,arguments).then(function(a){return c(b,a),a}),c(b,d),d)}var e,f,g="undefined"!=typeof b;return g&&(e={},f="function"==typeof b?b:JSON.stringify),d}function ca(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return a.apply(null,b).then(function(a){return console.log(a),a},function(a){throw console.error(a),a})}function da(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return a.apply(null,b).then(function(a){return console.dir(a),a},function(a){throw console.error(a),a})}function ea(a){return new Promise(function(b){setTimeout(function(){b.call(null)},a||1)})}function fa(){return new Promise(function(a){oa(a)})}function ga(){var a=va.call(arguments);return 0===a.length?Promise.resolve():new Promise(function(b,c){1===a.length&&Array.isArray(a[0])&&(a=a[0]);try{require(a,function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];b(1===a.length?a[0]:a)},function(a){c(a)})}catch(d){c(d)}})}function ha(a){var b=arguments,c=b[0],d=b[1],e=2;return"function"==typeof c&&"function"!=typeof d&&(d=c,c=void 0,e=1),ia(c,d).apply(null,va.call(b,e))}function ia(a,b){return"function"==typeof a&&"function"!=typeof b&&(b=a,a=void 0),function(){var c=va.call(arguments);return new Promise(function(d,e){function f(a){if(a)return e(a);var b=va.call(arguments,1);return 0===b.length?d():(1===b.length&&(b=b[0]),void d(b))}c.push(f),b.apply(a,c)})}}function ja(a){var b=arguments,c=b[0],d=b[1],e=2;return"function"==typeof c&&"function"!=typeof d&&(d=c,c=void 0,e=1),ka(c,d).apply(null,va.call(b,e))}function ka(a,b){return"function"==typeof a&&"function"!=typeof b&&(b=a,a=void 0),function(){var c=va.call(arguments);return new Promise(function(d,e){function f(){var a=va.call(arguments);return 0===a.length?d():(1===a.length&&(a=a[0]),void d(a))}function g(){var a=va.call(arguments);1===a.length&&(a=a[0]),a instanceof Error||(a=new Error(a.toString()),a.innerError=a),e(a)}c.push(f,g),b.apply(a,c)})}}function la(){var a={resolve:null,reject:null,promise:null};return a.promise=new Promise(function(b,c){a.resolve=b,a.reject=c}),a}function ma(){if("undefined"==typeof process||"[object process]"!=={}.toString.call(process))throw new Error("This method is only available in Node.JS environment");return require("./polyfill")}a.each=b,a.eachSeries=c,a.map=d,a.mapSeries=e,a.filter=f,a.filterSeries=g,a.reject=h,a.rejectSeries=i,a.reduce=j,a.reduceRight=k,a.find=l,a.findSeries=m,a.sortBy=n,a.some=o,a.every=p,a.concat=q,a.concatSeries=r;var na=Object.prototype.hasOwnProperty;a.series=u,a.parallel=x,a.whilst=y,a.doWhilst=z,a.until=A,a.doUntil=B,a.forever=C,a.waterfall=D,a.compose=E,a.seq=F,a.applyEach=G,a.applyEachSeries=H,a.retry=I,a.times=J,a.timesSeries=K;var oa=function(){if("undefined"!=typeof process&&"[object process]"==={}.toString.call(process))return global.setImmediate?function(a){global.setImmediate(a)}:function(a){process.nextTick(a)};if("undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel){var a=new MessageChannel;return function(b){a.port1.onmessage=b,a.port2.postMessage(0)}}var b="undefined"!=typeof window?window:{},c=[],d=function(){if(b.postMessage&&!b.importScripts){var a=!0,c=b.onmessage;return b.onmessage=function(){a=!1},b.postMessage("","*"),b.onmessage=c,a}};if(b.MutationObserver||b.WebKitMutationObserver){b.MutationObserver=b.MutationObserver||b.WebKitMutationObserver;var e=0,f=document.createTextNode(""),g=new b.MutationObserver(function(){for(var a;(a=c.shift())||c.length;)a()});return g.observe(f,{characterData:!0}),function(a){c.push(a),f.data=e=++e%2}}if(d()){var h="setImmediate$"+Math.random()+"$",i=function(a){if(a.source===b&&"string"==typeof a.data&&0===a.data.indexOf(h))for(var d=void 0;(d=c.shift())||c.length;)d()};return b.addEventListener?b.addEventListener("message",i,!1):b.attachEvent("onmessage",i),function(a){c.push(a),b.postMessage(h+1e3*Math.random(),"*")}}return function(a){setTimeout(a,1)}}(),pa=function(){function a(b){var c=this;if(this._progress=void 0,this._progressesCallbacks=[],!(this instanceof a))throw new TypeError("Failed to construct 'ProgressPromise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._innerPromise=new Promise(function(a,d){b(a,d,M(c))});var d=P.bind(this);this._innerPromise.then(d,d)}return a.prototype.progress=function(a){return this._progressesCallbacks&&this._progressesCallbacks.push(a),"undefined"!=typeof this._progress&&a.call(void 0,this._progress),this},a.prototype.then=function(a,b){return this._innerPromise.then(a,b)},a.prototype["catch"]=function(a){return this._innerPromise["catch"](a)},a.defer=function(){var b={};return b.promise=new a(function(a,c,d){b.resolve=a,b.reject=c,b.progress=d}),b},a.all=function(b){return new a(function(a,c,d){N(b,d),Promise.all(b).then(a,c)})},a.race=function(b){return new a(function(a,c,d){N(b,d),Promise.race(b).then(a,c)})},a}();a.ProgressPromise=pa;var qa=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},ra=function(){function a(a,b,c){void 0===b&&(b=1),this.worker=a,this.limit=b,this.items=[],this.workers=0,this.started=!1,this.paused=!1,this.hasException=!1,this.stopOnError=!1,this.waitToReject=!1,this.process=this.process.bind(this),c&&c.length>0&&this.push(c)}return a.prototype.push=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return 1===a.length&&Array.isArray(a[0])&&(a=a[0]),this.insert(a)},a.prototype.unshift=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return 1===a.length&&Array.isArray(a[0])&&(a=a[0]),this.insert(a,!0)},a.prototype.length=function(){return this.items.length},a.prototype.running=function(){return this.workers>0},a.prototype.idle=function(){return this.items.length+this.workers===0},a.prototype.pause=function(){this.paused||(this.paused=!0)},a.prototype.resume=function(){if(this.paused&&this.hasException){this.paused=!1,this.hasException=!1;for(var a=0,b=this.limit,c=this.process.bind(this);b>a;a++)oa(c)}},a.prototype.clear=function(){this.ondrain=null,this.items=[]},a.prototype.insert=function(a,b){function c(a){return oa(this.process),this.createItem(a,i,h,g,d,e)}var d,e,f=new Promise(function(a,b){d=a,e=b}),g=a.length,h=[],i=[];return 0===g?Promise.resolve([]):(this.started||(this.started=!0),b?this.items.unshift.apply(this.items,a.map(c,this)):this.items.push.apply(this.items,a.map(c,this)),this.onsaturated&&this.items.length>=this.limit&&this.onsaturated(),f)},a.prototype.createItem=function(a,b,c,d,e,f){var g=this;return{data:a,resolver:function(a){b.push(a),b.length===d&&e(1===d?b[0]:b)},rejecter:function(a){if(!g.waitToReject)return f(a);if(c.push(a),c.length+b.length===d){var e=new Error("Queue worker exception");1===d?e.innerException=c[0]:e.innerExceptions=c,f(e)}}}},a.prototype.process=function(){var a=this;if(!this.paused&&this.workers<this.limit&&this.items.length>0&&(!this.stopOnError||!this.hasException)){var b=this.items.shift();this.onempty&&0===this.items.length&&this.onempty(),this.workers+=1,Promise.resolve(this.worker(b.data)).then(function(c){b.resolver.call(void 0,c),a.onProcessEnd()},function(c){b.rejecter.call(void 0,c),a.hasException=!0,a.onProcessEnd()})}},a.prototype.onProcessEnd=function(){this.workers-=1,this.ondrain&&this.items.length+this.workers===0&&this.ondrain(),this.process()},a}();a.Queue=ra;var sa=function(a){function b(b,c,d){a.call(this,b,c,d),this.defaultPriority=1}return qa(b,a),b.prototype.push=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=this.defaultPriority;return"number"==typeof a[0]&&(c=a.shift()),1===a.length&&Array.isArray(a[0])&&(a=a[0]),this.insertAt(a,c)},b.prototype.unshift=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=this.defaultPriority;return"number"==typeof a[0]&&(c=a.shift()),1===a.length&&Array.isArray(a[0])&&(a=a[0]),this.insertAt(a,c)},b.prototype.insertAt=function(a,b){function c(a){var c=this.createItem(a,i,h,d,e,f);return c.priority=b,oa(this.process),c}var d=a.length;if(0===d)return Promise.resolve([]);var e,f,g=new Promise(function(a,b){e=a,f=b}),h=[],i=[],j=this.binarySearch(this.items,{priority:b},this.compareTasks)+1;return this.started||(this.started=!0),this.items.splice.apply(this.items,[j,0].concat(a.map(c,this))),this.onsaturated&&this.items.length>=this.limit&&this.onsaturated(),g},b.prototype.binarySearch=function(a,b,c){for(var d,e=-1,f=a.length-1;f>e;)d=e+(f-e+1>>>1),c(b,a[d])>=0?e=d:f=d-1;return e},b.prototype.compareTasks=function(a,b){return a.priority-b.priority},b}(ra);a.PriorityQueue=sa;var ta=function(a){function b(b,c){a.call(this,function(a){return a()},b,c)}return qa(b,a),b}(ra);a.TaskQueue=ta;var ua=function(a){function b(b,c){a.call(this,function(a){return a()},b,c)}return qa(b,a),b}(sa);a.PriorityTaskQueue=ua,a.queue=Q,a.priorityQueue=R,a.taskQueue=S,a.priorityTaskQueue=T,a.eachLimit=U,a.mapLimit=V,a.parallelLimit=W;var va=Array.prototype.slice;a.apply=X,a.applyOn=Y,a.partial=Z,a.partialOn=$,a.tap=_,a.tapOn=aa,a.memoize=ba,a.log=ca,a.dir=da,a.timeout=ea,a.immediate=fa,a.module=ga,a.denodify=ha,a.promisify=ia,a.uncallbackify=ja,a.cbpromisify=ka,a.defer=la,a.polyfill=ma});