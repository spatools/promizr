!function(a,b){"object"==typeof exports?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.promizr=a.pzr={})}(this,function(a){function b(a,b){var c=a.map(b);return Promise.all(c).then(function(){})}function c(a,b){return new Promise(function(c,d){function e(c,d){return function(){return b(c,d,a)}}for(var f=Promise.resolve(),g=0,h=a.length;h>g;g++)f=f.then(e(a[g],g));return f.then(function(){return c()},d)})}function d(a,b){var c=a.map(b);return Promise.all(c)}function e(a,b){function d(c,d){return b(c,d,a).then(function(a){e[d]=a})}var e=[];return c(a,d).then(function(){return e})}function f(a,b){var c=[],d=a.map(function(a,d,e){return b(a,d,e).then(function(b){b&&c.push(a)})});return Promise.all(d).then(function(){return c})}function g(a,b){function d(c,d){return b(c,d,a).then(function(a){a&&e.push(c)})}var e=[];return c(a,d).then(function(){return e})}function h(a,b){var c=[],d=a.map(function(a,d,e){return b(a,d,e).then(function(b){b||c.push(a)})});return Promise.all(d).then(function(){return c})}function i(a,b){function d(c,d){return b(c,d,a).then(function(a){a||e.push(c)})}var e=[];return c(a,d).then(function(){return e})}function j(a,b,d){function e(a,c){return d(b,a).then(function(a){b=a})}return c(a,e).then(function(){return b})}function k(a,b,c){var d=[].concat(a).reverse();return j(d,b,c)}function l(a,b){var c=[],d=a.map(function(d,e,f){return b(d,e,f).then(function(b){return b?d:new Promise(function(b,d){c.length===a.length-1?d("PROMIZR_NOTFOUND"):c.push(b)})})});return Promise.race(d)["catch"](function(a){if("PROMIZR_NOTFOUND"!==a)throw a}).then(function(a){for(;c.length;)c.pop().call(null);return a})}function m(a,b){function d(c,d){return b(c,d,a).then(function(a){return a?Promise.reject({success:!0,data:c}):void 0})}return c(a,d)["catch"](function(a){if(!a.success)throw a;return a.data})}function n(a,b){function c(c,d){return b(c,d,a).then(function(a){return{source:c,result:a}})}function e(a,b){var c=a.result,d=b.result;return d>c?-1:c>d?1:0}return d(a,c).then(function(a){return a.sort(e).map(function(a){return a.source})})}function o(a,b){return l(a,b).then(function(a){return!!a})}function p(a,b){var c=a.map(function(a,c,d){return b(a,c,d).then(function(a){if(!a)throw new Error("PROMIZR_NOTOK")})});return Promise.all(c).then(function(){return!0})["catch"](function(a){if("PROMIZR_NOTOK"!==a.message)throw a;return!1})}function q(a,b){var c=[],d=a.map(function(d,e){return b(d,e,a).then(function(a){c=c.concat(a||[])})});return Promise.all(d).then(function(){return c})}function r(a,b){return e(a,b).then(function(a){return Array.prototype.concat.apply([],a.filter(function(a){return!!a}))})}function s(a){function b(b){return a[b]().then(function(a){f.push(a)})}for(var c=Promise.resolve(),d=0,e=a.length,f=[];e>d;d++)c=c.then(b.bind(null,d));return c.then(function(){return f})}function t(a){function b(b){return a[b]().then(function(a){e[b]=a})}var c,d=Promise.resolve(),e={};for(c in a)a.hasOwnProperty(c)&&(d=d.then(b.bind(null,c)));return d.then(function(){return e})}function u(a){return Array.isArray(a)?s(a):t(a)}function v(a){var b=a.map(function(a){return a()});return Promise.all(b)}function w(a){function b(b){return a[b]().then(function(a){e[b]=a})}var c,d=[],e={};for(c in a)a.hasOwnProperty(c)&&d.push(b(c));return Promise.all(d).then(function(){return e})}function x(a){return Array.isArray(a)?v(a):w(a)}function y(a,b){return Promise.reject("not implemented")}function z(a,b){function c(){return a()?b().then(c):void 0}return Promise.resolve().then(c)}function A(a,b){function c(){return a().then(function(a){return b(a)?c():void 0})}return Promise.resolve().then(c)}function B(a,b){function c(){return a()?void 0:b().then(c)}return Promise.resolve().then(c)}function C(a,b){function c(){return a().then(function(a){return b(a)?void 0:c()})}return Promise.resolve().then(c)}function D(a){function b(){return a().then(b)}return Promise.resolve().then(b)}function E(a){for(var b=Promise.resolve(),c=0,d=a.length;d>c;c++)b=b.then(a[c]);return b}function F(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return function(){for(var b=a.pop().apply(this,arguments),c=a.length-1;c>=0;c--)b=b.then(a[c]);return b}}function G(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return function(){for(var b=a.shift().apply(this,arguments),c=0,d=a.length;d>c;c++)b=b.then(a[c]);return b}}function H(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return b.length>0?(a=a.map(function(a){return a.bind.apply(a,[null].concat(b))}),x(a)):function(){var b=this;return a=a.map(function(a){return a.bind.apply(a,[b].concat(arguments))}),x(a)}}function I(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return b.length>0?(a=a.map(function(a){return a.bind.apply(a,[null].concat(b))}),u(a)):function(){var b=this;return a=a.map(function(a){return a.bind.apply(a,[b].concat(arguments))}),u(a)}}function J(a,b){var c=0;return b()["catch"](function(d){if(c++<a)return b();throw d})}function K(a,b){for(var c=[],d=a;d>0;d--)c.push(b());return Promise.all(c)}function L(a,b){function c(){return b().then(function(a){e.push(a)})}for(var d=Promise.resolve(),e=[],f=a;f>0;f--)d=d.then(c);return d.then(function(){return e})}function M(a,b,c){return new ha(a,b,c)}function N(a,b,c){return new ia(a,b,c)}function O(a,b){return new ja(a,b)}function P(a,b){return new ka(a,b)}function Q(a,b,c){var d=a.map(function(a,b,d){return function(){return c(a,b,d)}});return O(b).push(d).then(function(){})}function R(a,b,c){var d=a.map(function(a,b,d){return function(){return c(a,b,d)}});return O(b).push(d)}function S(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return function(){return a.apply(null,b)}}function T(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];return function(){return"string"==typeof b?a[b].apply(a,c):b.apply(a,c)}}function U(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return function(){return a.apply(null,b.concat(arguments))}}function V(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];return function(){return"string"==typeof b?a[b].apply(a,c.concat(arguments)):b.apply(a,c.concat(arguments))}}function W(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return function(c){return a.apply(null,b),c}}function X(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];return function(d){return"string"==typeof b?a[b].apply(a,c):b.apply(a,c),d}}function Y(a,b){function c(a,b){g?e[a]=b:e=b}function d(){var b,d,h=Array.prototype.slice.apply(arguments);return g?(b=f(h),d=e[b]):d=e,d?Promise.resolve(d):(d=a.apply(null,arguments).then(function(a){return c(b,a),a}),c(b,d),d)}var e,f,g="undefined"!=typeof b;return g&&(e={},f="function"==typeof b?b:JSON.stringify),d}function Z(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return a.apply(null,b).then(function(a){return console.log(a),a},function(a){throw console.error(a),a})}function $(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return a.apply(null,b).then(function(a){return console.dir(a),a},function(a){throw console.error(a),a})}function _(a){return new Promise(function(b){setTimeout(function(){b.call(null)},a||1)})}function aa(){return new Promise(function(a){nextTick(a)})}function ba(){var a=Array.prototype.slice.call(arguments);return 0===a.length?Promise.resolve():new Promise(function(b,c){1===a.length&&Array.isArray(a[0])&&(a=a[0]);try{require(a,function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];b(1===a.length?a[0]:a)},function(a){c(a)})}catch(d){c(d)}})}function ca(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=a[1],d=a[0];return"function"==typeof d&&"function"!=typeof c&&(c=d,d=null),new Promise(function(b,e){function f(a){if(a)return e(a);var c=Array.prototype.slice.call(arguments,1);1===c.length&&(c=c[0]),b(c)}c.call(d,a.concat([f]))})}function da(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=a[1],d=a[0];return"function"==typeof d&&"function"!=typeof c&&(c=d,d=null),new Promise(function(b,e){function f(){var a=Array.prototype.slice.call(arguments,0);1===a.length&&(a=a[0]),b(a)}function g(){var a=Array.prototype.slice.call(arguments,0);1===a.length&&(a=a[0]),a instanceof Error||(a=new Error(a.toString()),a.innerError=a),e(a)}c.call(d,a.concat([f,g]))})}function ea(){var a={resolve:null,reject:null,promise:null};return a.promise=new Promise(function(b,c){a.resolve=b,a.reject=c}),a}function fa(){if("undefined"==typeof process||"[object process]"!=={}.toString.call(process))throw new Error("This method is only available in Node.JS environment");return require("./polyfill")}a.each=b,a.eachSeries=c,a.map=d,a.mapSeries=e,a.filter=f,a.filterSeries=g,a.reject=h,a.rejectSeries=i,a.reduce=j,a.reduceRight=k,a.find=l,a.findSeries=m,a.sortBy=n,a.some=o,a.every=p,a.concat=q,a.concatSeries=r,a.series=u,a.parallel=x,a.parallelLimit=y,a.whilst=z,a.doWhilst=A,a.until=B,a.doUntil=C,a.forever=D,a.waterfall=E,a.compose=F,a.seq=G,a.applyEach=H,a.applyEachSeries=I,a.retry=J,a.times=K,a.timesSeries=L,a.nextTick=function(){if("undefined"!=typeof process&&"[object process]"==={}.toString.call(process))return global.setImmediate?function(a){global.setImmediate(a)}:function(a){process.nextTick(a)};if("undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel){var a=new MessageChannel;return function(b){a.port1.onmessage=b,a.port2.postMessage(0)}}var b,c="undefined"!=typeof window?window:{},d=function(){if(c.postMessage&&!c.importScripts){var a=!0,b=c.onmessage;return c.onmessage=function(){a=!1},c.postMessage("","*"),c.onmessage=b,a}};if(c.MutationObserver||c.WebKitMutationObserver){c.MutationObserver=c.MutationObserver||c.WebKitMutationObserver;var e=0,f=document.createTextNode(""),g=new c.MutationObserver(function(){b&&b(),b=null});return g.observe(f,{characterData:!0}),function(a){b=a,f.data=e=++e%2}}if(d()){var h="setImmediate$"+Math.random()+"$",i=function(a){a.source===c&&"string"==typeof a.data&&0===a.data.indexOf(h)&&b&&(b(),b=null)};return c.addEventListener?c.addEventListener("message",i,!1):c.attachEvent("onmessage",i),function(a){b=a,c.postMessage(h+1e3*Math.random(),"*")}}return function(a){setTimeout(a,1)}}();var ga=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},ha=function(){function a(a,b,c){this.items=[],this.limit=1,this.workers=0,this.started=!1,this.paused=!1,b&&(this.limit=b),this.worker=a,c&&c.length>0&&this.push.apply(this,c)}return a.prototype.push=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return 1===a.length&&Array.isArray(a[0])&&(a=a[0]),this.insert(a)},a.prototype.unshift=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];return 1===a.length&&Array.isArray(a[0])&&(a=a[0]),this.insert(a,!0)},a.prototype.length=function(){return this.items.length},a.prototype.running=function(){return this.workers>0},a.prototype.idle=function(){return this.items.length+this.workers===0},a.prototype.pause=function(){this.paused||(this.paused=!0)},a.prototype.resume=function(){if(this.paused){this.paused=!1;for(var a=0,b=this.limit,c=this.process.bind(this);b>a;a++)nextTick(c)}},a.prototype.clear=function(){this.ondrain=null,this.items=[]},a.prototype.insert=function(a,b){function c(b){return nextTick(g),{data:b,resolver:function(b){f.push(b),f.length===a.length&&d(1===f.length?f[0]:f)}}}var d,e=new Promise(function(a){d=a}),f=[],g=this.process.bind(this);return 0===a.length?Promise.resolve([]):(this.started||(this.started=!0),b?this.items.unshift.apply(this.items,a.map(c,this)):this.items.push.apply(this.items,a.map(c,this)),this.onsaturated&&this.items.length>=this.limit&&this.onsaturated(),e)},a.prototype.process=function(){var a=this;if(!this.paused&&this.workers<this.limit&&this.items.length>0){var b=this.items.shift();this.onempty&&0===this.items.length&&this.onempty(),this.workers+=1,this.worker(b.data).then(function(c){a.workers-=1,b.resolver.call(null,c),a.ondrain&&a.items.length+a.workers===0&&a.ondrain(),a.process()})}},a}();a.Queue=ha;var ia=function(a){function b(b,c,d){a.call(this,b,c,d),this.defaultPriority=1}return ga(b,a),b.prototype.push=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=this.defaultPriority;return"number"==typeof a[0]&&(c=a.shift()),1===a.length&&Array.isArray(a[0])&&(a=a[0]),this.insertAt(a,c)},b.prototype.unshift=function(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=this.defaultPriority;return"number"==typeof a[0]&&(c=a.shift()),1===a.length&&Array.isArray(a[0])&&(a=a[0]),this.insertAt(a,c)},b.prototype.insertAt=function(a,b){function c(c){return nextTick(g),{priority:b,data:c,resolver:function(b){f.push(b),f.length===a.length&&d(1===f.length?f[0]:f)}}}if(0===a.length)return Promise.resolve([]);var d,e=new Promise(function(a){d=a}),f=[],g=this.process.bind(this),h=this.binarySearch(this.items,{priority:b},this.compareTasks)+1;return this.started||(this.started=!0),this.items.splice.apply(this.items,[h,0].concat(a.map(c,this))),this.onsaturated&&this.items.length>=this.limit&&this.onsaturated(),e},b.prototype.binarySearch=function(a,b,c){for(var d,e=-1,f=a.length-1;f>e;)d=e+(f-e+1>>>1),c(b,a[d])>=0?e=d:f=d-1;return e},b.prototype.compareTasks=function(a,b){return a.priority-b.priority},b}(ha);a.PriorityQueue=ia;var ja=function(a){function b(b,c){a.call(this,function(a){return a()},b,c)}return ga(b,a),b}(ha);a.TaskQueue=ja;var ka=function(a){function b(b,c){a.call(this,function(a){return a()},b,c)}return ga(b,a),b}(ia);a.PriorityTaskQueue=ka,a.queue=M,a.priorityQueue=N,a.taskQueue=O,a.priorityTaskQueue=P,a.eachLimit=Q,a.mapLimit=R,a.apply=S,a.applyOn=T,a.partial=U,a.partialOn=V,a.tap=W,a.tapOn=X,a.memoize=Y,a.log=Z,a.dir=$,a.timeout=_,a.immediate=aa,a.module=ba,a.denodify=ca,a.uncallbackify=da,a.defer=ea,a.polyfill=fa});