!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).promizr={})}(this,(function(t){"use strict";var n=function(t,r){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(t,r)};function r(t,r){function e(){this.constructor=t}n(t,r),t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}function e(){for(var t=0,n=0,r=arguments.length;n<r;n++)t+=arguments[n].length;var e=Array(t),o=0;for(n=0;n<r;n++)for(var i=arguments[n],u=0,c=i.length;u<c;u++,o++)e[o]=i[u];return e}var o=Promise.resolve.bind(Promise);function i(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];try{return o(t.apply(void 0,n))}catch(t){return Promise.reject(t)}}function u(t){return Array.isArray(t)?(n=t.map((function(t){return i(t)})),Promise.all(n)):function(t){var n={},r=[];for(var e in t)"function"==typeof t[e]&&r.push(o(e,t[e]));return Promise.all(r).then((function(){return n}));function o(t,r){return i(r).then((function(r){n[t]=r}))}}(t);var n}function c(t){return Array.isArray(t)?function(t){for(var n=[],r=t.length,e=o(),i=0;i<r;i++)e=e.then(u(t[i]));return e.then((function(){return n}));function u(t){return function(){return o(t()).then((function(t){n.push(t)}))}}}(t):function(t){var n={},r=o();for(var e in t)"function"==typeof t[e]&&(r=r.then(i(e,t[e])));return r.then((function(){return n}));function i(t,r){return function(){return o(r()).then((function(r){n[t]=r}))}}}(t)}function f(t,n){for(var r=[],e=2;e<arguments.length;e++)r[e-2]=arguments[e];try{return o(n.apply(t,r))}catch(t){return Promise.reject(t)}}function s(t,n){if("function"==typeof t&&"function"!=typeof n&&(n=t,t=void 0),!n)throw new TypeError("fn should be provided!");var r=n;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return new Promise((function(o,i){r.apply(t,e(n,[function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(0===t.length)return o();if(1===t.length)return o(t[0]);o(t)},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(1===t.length)return i(t[0]);i(t)}]))}))}}function a(t,n){var r=t.map((function(t,r,e){return i(n,t,r,e)}));return Promise.all(r)}function h(t,n){return new Promise((function(r,e){for(var i=t.length,u=o(),c=0;c<i;c++)u=u.then(f(t[c],c,t));return u.then((function(){return r()}),e);function f(t,r,e){return function(){return n(t,r,e)}}}))}function p(t,n){var r=[];return h(t,(function(t,e,i){return o(n(t,e,i)).then((function(t){r[e]=t}))})).then((function(){return r}))}function l(){var t={};return t.promise=new Promise((function(n,r){t.resolve=n,t.reject=r})),t}function v(t,n){if("function"==typeof t&&"function"!=typeof n&&(n=t,t=void 0),!n)throw new TypeError("fn should be provided!");var r=n;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return new Promise((function(o,i){r.apply(t,e(n,[function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(t)return i(t);if(0===n.length)return o();if(1===n.length)return o(n[0]);o(n)}]))}))}}function y(t,n){var r=t.map((function(t,r,e){return i(n,t,r,e)}));return Promise.all(r).then((function(){}))}var m,d,g=function(t){function n(r,e){var o=t.call(this,"Errors occured while executing the Queue")||this;return o.name=o.constructor.name,Object.setPrototypeOf&&Object.setPrototypeOf(o,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,o.constructor),o.innerErrors=r,o.results=e,o}return r(n,t),n}(Error);!function(t){if(t.setImmediate&&t.clearImmediate)return m=t.setImmediate,void(d=t.clearImmediate);var n,r,e=t.document,o={},i=1,u=!1,c="[object process]"==={}.toString.call(t.process)?function(t){process.nextTick((function(){f(t)}))}:function(){if(t.postMessage&&!t.importScripts){var n=!0,r=function(){n=!1,t.removeEventListener?t.removeEventListener("message",r,!1):t.detachEvent("onmessage",r)};return t.addEventListener?t.addEventListener("message",r,!1):t.attachEvent("onmessage",r),t.postMessage("","*"),n}}()?function(){var n="setImmediate$"+Math.random()+"$";return t.addEventListener?t.addEventListener("message",r,!1):t.attachEvent("onmessage",r),function(r){t.postMessage(n+r,"*")};function r(r){r.source===t&&"string"==typeof r.data&&function(t,n){for(var r=n.length,e=0;e<r;e++)if(t[e]!==n[e])return!1;return!0}(r.data,n)&&f(+r.data.slice(n.length))}}():t.MessageChannel?((r=new t.MessageChannel).port1.onmessage=function(t){f(t.data)},function(t){r.port2.postMessage(t)}):e&&"onreadystatechange"in e.createElement("script")?(n=e.documentElement,function(t){var r=e.createElement("script");r.onreadystatechange=function(){f(t),r.onreadystatechange=null,n.removeChild(r),r=null},n.appendChild(r)}):function(t){setTimeout(f,0,t)};function f(t){if(u)setTimeout(f,0,t);else{var n=o[t];if(n){u=!0;try{var r=n.c,e=n.a;r.apply(void 0,e)}finally{d(t),u=!1}}}}m=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return"function"!=typeof t&&(t=new Function(""+t)),o[i]={c:t,a:n},c(i),i++},d=function(t){delete o[t]}}("undefined"==typeof self?"undefined"==typeof global?void 0:global:self);var P=m,w=d,E=function(){function t(t,n,r){if(void 0===n&&(n=1),this.items=[],this.workers=0,this.started=!1,this.paused=!1,this.hasException=!1,this.stopOnError=!1,this.waitToReject=!1,this.worker=t,this.limit=n,r)for(var e=0,o=Object.keys(r);e<o.length;e++){var i=o[e];r[i]&&(this[i]=r[i])}}return Object.defineProperty(t.prototype,"length",{get:function(){return this.items.length+this.workers},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return this.workers>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"idle",{get:function(){return this.items.length+this.workers===0},enumerable:!1,configurable:!0}),t.prototype.push=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return 1===t.length&&Array.isArray(t[0])&&(t=t[0]),this.insert(t)},t.prototype.unshift=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return 1===t.length&&Array.isArray(t[0])&&(t=t[0]),this.insert(t,!0)},t.prototype.pause=function(){this.paused=!0},t.prototype.resume=function(){if(this.paused){this.paused=!1,this.hasException=!1;for(var t=this.limit;t>0;t--)this.process()}},t.prototype.clear=function(){this.ondrain=void 0,this.items=[]},t.prototype.insert=function(t,n){var r,e,o=t.length;if(0===o)return Promise.resolve([]);var i=l();this.started||(this.started=!0);var u=function(t,n){var r=[],e=[];return function(o){return this.createItem(o,e,r,t,n.resolve,n.reject)}}(o,i);n?(r=this.items).unshift.apply(r,t.map(u,this)):(e=this.items).push.apply(e,t.map(u,this)),this.onsaturated&&this.items.length>=this.limit&&this.onsaturated();for(var c=this.limit;c>0;c--)this.process();return i.promise},t.prototype.createItem=function(t,n,r,e,o,i){var u=this;return{data:t,resolver:function(t){n.push(t);var u=n.length;u===e&&o(1===u?n[0]:n),r.length+u===e&&i(new g(r,n))},rejecter:function(t){if(!u.waitToReject||u.stopOnError)return i(t);r.push(t),r.length+n.length===e&&i(new g(r,n))}}},t.prototype.process=function(){if(!(this.paused||this.workers>=this.limit||!this.items.length||this.stopOnError&&this.hasException)){var t=this.items.shift();t&&(this.onempty&&0===this.items.length&&this.onempty(),this.workers+=1,P(this.createItemProcess(t)))}},t.prototype.createItemProcess=function(t){var n=this;return function(){i(n.worker,t.data).then((function(r){t.resolver.call(void 0,r),n.onProcessEnd()}),(function(r){t.rejecter.call(void 0,r),n.hasException=!0,n.onProcessEnd()}))}},t.prototype.onProcessEnd=function(){this.workers-=1,this.ondrain&&this.items.length+this.workers===0&&this.ondrain(),this.process()},t}(),b=function(t){function n(n,r){return t.call(this,(function(t){return t()}),n,r)||this}return r(n,t),n}(E);function j(t,n,r,e){var o=new b(n,e||{stopOnError:!0}),i=t.map((function(t,n,e){return function(){return r(t,n,e)}}));return o.push(i).then((function(){}))}function k(t,n){var r=t.length,e=0;return new Promise((function(o,u){t.forEach((function(t,c,f){return i(n,t,c,f).then((function(n){if(n)return o(t);++e===r&&o()}),u)}))}))}function O(t,n,r){return t[n||"default"]=r,r}var _=function(t){function n(n,r,e){var o=t.call(this,n,r,e)||this;return o.defaultPriority=1,o.items=[],void 0!==(null==e?void 0:e.defaultPriority)&&(o.defaultPriority=e.defaultPriority),o}return r(n,t),n.prototype.push=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=this.defaultPriority;return"number"==typeof t[0]&&t.length>1&&(r=t.shift()),1===t.length&&Array.isArray(t[0])&&(t=t[0]),this.insertAt(t,r)},n.prototype.unshift=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=this.defaultPriority;return"number"==typeof t[0]&&t.length>1&&(r=t.shift()),1===t.length&&Array.isArray(t[0])&&(t=t[0]),this.insertAt(t,r)},n.prototype.insertAt=function(t,n){var r,o=t.length;if(0===o)return Promise.resolve([]);var i=this.binarySearch(this.items,{priority:n},this.compareTasks)+1,u=l();this.started||(this.started=!0);var c=function(t,n,r){var e=[],o=[];return function(i){var u=this.createItem(i,o,e,t,n.resolve,n.reject);return u.priority=r,u}}(o,u,n);(r=this.items).splice.apply(r,e([i,0],t.map(c,this))),this.onsaturated&&this.items.length>=this.limit&&this.onsaturated();for(var f=this.limit;f>0;f--)this.process();return u.promise},n.prototype.binarySearch=function(t,n,r){for(var e,o=-1,i=t.length-1;o<i;)r(n,t[e=o+(i-o+1>>>1)])>=0?o=e:i=e-1;return o},n.prototype.compareTasks=function(t,n){return(t.priority||0)-(n.priority||0)},n}(E),A=function(t){function n(n,r){return t.call(this,(function(t){return t()}),n,r)||this}return r(n,t),n}(_),T=function(){function t(n){var r=this;if(this._progress=void 0,this._progressesCallbacks=[],!(this instanceof t))throw new TypeError("Failed to construct 'ProgressPromise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._innerPromise=new Promise((function(t,e){n(t,e,r.createProgressFunction())}));var e=this.cleaner.bind(this);this._innerPromise.then(e,e)}return t.prototype.progress=function(t){var n;return"function"!=typeof t||(null===(n=this._progressesCallbacks)||void 0===n||n.push(t),void 0!==this._progress&&t(this._progress)),this},t.prototype.then=function(t,n){return this._innerPromise.then(t,n)},t.prototype.catch=function(t){return this._innerPromise.catch(t)},t.prototype.finally=function(t){return"function"!=typeof t?this._innerPromise.then():this._innerPromise.then((function(n){return o(t()).then((function(){return n}))}),(function(n){return o(t()).then((function(){throw n}))}))},t.defer=function(){var n={};return n.promise=new t((function(t,r,e){n.resolve=t,n.reject=r,n.progress=e})),n},t.all=function(n){return new t((function(t,r,e){S(n,e),Promise.all(n).then(t,r)}))},t.race=function(n){return new t((function(t,r,e){S(n,e),Promise.race(n).then(t,r)}))},t.prototype.cleaner=function(){this._progressesCallbacks=void 0},t.prototype.createProgressFunction=function(){var t=this;return function(n){var r=t._progressesCallbacks;if(r){for(var e=r.length,o=0;o<e;o++)r[o](n);t._progress=n}}},t}();function S(t,n){for(var r=t.length,e=new Array(r),o=0;o<r;o++){var i=t[o];e[o]=void 0,I(i)&&i.progress(x(n,e,o))}}function x(t,n,r){return function(e){n[r]=e,t(n)}}function I(t){return"progress"in t&&"then"in t}t.PriorityQueue=_,t.PriorityTaskQueue=A,t.ProgressPromise=T,t.Queue=E,t.QueueError=g,t.TaskQueue=b,t.apply=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(){return i.apply(void 0,e([t],n))}},t.applyEach=function(t){return function(){for(var n=this,r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var o=t.map((function(t){return function(){return t.apply(n,r)}}));return u(o)}},t.applyEachSeries=function(t){return function(){for(var n=this,r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var o=t.map((function(t){return function(){return t.apply(n,r)}}));return c(o)}},t.applyOn=function(t,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i="string"==typeof n?t[n]:n;return function(){return f.apply(void 0,e([t,i],r))}},t.cbpromisify=s,t.clearImmediate=w,t.compose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(){for(var n=this,r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var i=o(),u=t.length;if(!u)return i;var c=t[u-1];i=i.then((function(){return c.apply(n,r)}));for(var f=u-2;f>=0;f--)i=i.then(t[f]);return i}},t.concat=function(t,n){return a(t,n).then((function(t){var n;return(n=[]).concat.apply(n,t.filter((function(t){return!!t})))}))},t.concatSeries=function(t,n){return p(t,n).then((function(t){var n;return(n=[]).concat.apply(n,t.filter((function(t){return!!t})))}))},t.defer=l,t.denodify=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var e=t,o=n[0],i=1;return"function"==typeof e&&"function"!=typeof o&&(o=e,e=void 0,i=0),v(e,o).apply(void 0,n.slice(i))},t.dir=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return i.apply(void 0,e([t],n)).then((function(t){return console.dir(t),t}),(function(t){throw console.error(t),t}))},t.doUntil=function(t,n){return function r(){return i(t).then((function(t){return n(t)})).then((function(t){if(!t)return r()}))}()},t.doWhilst=function(t,n){return function r(){return i(t).then((function(t){return n(t)})).then((function(t){if(t)return r()}))}()},t.each=y,t.eachLimit=j,t.eachSeries=h,t.every=function(t,n){return k(t,(function(t,r,e){return i(n,t,r,e).then((function(t){return!t}))})).then((function(t){return!t}))},t.exec=i,t.execOn=f,t.filter=function(t,n){var r=[];return Promise.all(t.map((function(t,e,o){return i(n,t,e,o).then((function(n){n&&r.push(t)}))}))).then((function(){return r}))},t.filterSeries=function(t,n){var r=[];return h(t,(function(e,i){return o(n(e,i,t)).then((function(t){t&&r.push(e)}))})).then((function(){return r}))},t.find=k,t.findSeries=function(t,n){var r=t.length-1;return function e(o){void 0===o&&(o=0);var u=t[o];return i(n,u,o,t).then((function(t){return t?u:o<r?e(o+1):void 0}))}()},t.forEach=y,t.forEachLimit=j,t.forEachSeries=h,t.forever=function(t){return function n(){return i(t).then(n)}()},t.immediate=function(){return new Promise((function(t){P(t)}))},t.log=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return i.apply(void 0,e([t],n)).then((function(t){return console.log(t),t}),(function(t){throw console.error(t),t}))},t.map=a,t.mapLimit=function(t,n,r,e){var o=new b(n,e||{stopOnError:!0}),i=t.map((function(t,n,e){return function(){return r(t,n,e)}}));return o.push(i)},t.mapSeries=p,t.memoize=function(t,n){var r={},u="function"==typeof n?n:!0===n?JSON.stringify:void 0;return function(){for(var n=[],c=0;c<arguments.length;c++)n[c]=arguments[c];var f=null==u?void 0:u(n),s=r[f||"default"];if(s)return o(s);var a=i.apply(void 0,e([t],n)).then((function(t){return O(r,f,t)}));return O(r,f,a)}},t.nextTick=function(t){P(t)},t.parallel=u,t.parallelLimit=function(t,n,r){if(r=r||{stopOnError:!0},Array.isArray(t))return new b(n,r).push(t);var e=t,o={};return new E((function(t){return f(e,e[t]).then((function(n){o[t]=n}))}),n,r).push(Object.keys(e)).then((function(){return o}))},t.partial=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return i.apply(void 0,e([t],n.concat(r)))}},t.partialOn=function(t,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i="string"==typeof n?t[n]:n;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return f.apply(void 0,e([t,i],r.concat(n)))}},t.promisify=v,t.reduce=function(t,n,r){return h(t,(function(t,e,i){return o(r(n,t,e,i)).then((function(t){n=t}))})).then((function(){return n}))},t.reduceRight=function(t,n,r){return h(e(t).reverse(),(function(e,i){return o(r(n,e,i,t)).then((function(t){n=t}))})).then((function(){return n}))},t.reject=function(t,n){var r=[];return Promise.all(t.map((function(t,e,o){return i(n,t,e,o).then((function(n){n||r.push(t)}))}))).then((function(){return r}))},t.rejectSeries=function(t,n){var r=[];return h(t,(function(t,e,i){return o(n(t,e,i)).then((function(n){n||r.push(t)}))})).then((function(){return r}))},t.resolve=o,t.retry=function t(n,r){return i(r).catch((function(e){if(n>1)return t(n-1,r);throw e}))},t.seq=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(){for(var n=this,r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var i=o(),u=t.length;if(!u)return i;var c=t[0];i=i.then((function(){return c.apply(n,r)}));for(var f=1;f<u;f++)i=i.then(t[f]);return i}},t.series=c,t.setImmediate=P,t.some=function(t,n){return k(t,n).then((function(t){return!!t}))},t.sortBy=function(t,n){return a(t,(function(r,e){return o(n(r,e,t)).then((function(t){return{source:r,result:t}}))})).then((function(t){return t.sort(r).map((function(t){return t.source}))}));function r(t,n){var r=t.result,e=n.result;return r<e?-1:r>e?1:0}},t.tap=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return function(r){return i.apply(void 0,e([t],n)).then((function(){return r}))}},t.tapOn=function(t,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i="string"==typeof n?t[n]:n;return function(n){return f.apply(void 0,e([t,i],r)).then((function(){return n}))}},t.timeout=function(t){return new Promise((function(n){setTimeout((function(){n()}),t||1)}))},t.times=function(t,n){for(var r=[],e=t;e>0;e--)r.push(i(n));return Promise.all(r)},t.timesSeries=function(t,n){for(var r=[],e=o(),i=t;i>0;i--)e=e.then(u);return e.then((function(){return r}));function u(){return o(n()).then((function(t){r.push(t)}))}},t.uncallbackify=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var e=t,o=n[0],i=1;return"function"==typeof e&&"function"!=typeof o&&(o=e,e=void 0,i=0),s(e,o).apply(void 0,n.slice(i))},t.until=function(t,n){return function r(){return i(t).then((function(t){if(!t)return i(n).then(r)}))}()},t.waterfall=function(t){for(var n=o(),r=0,e=t;r<e.length;r++){var i=e[r];n=n.then(i)}return n},t.whilst=function(t,n){return function r(){return i(t).then((function(t){if(t)return i(n).then(r)}))}()},Object.defineProperty(t,"__esModule",{value:!0})}));
